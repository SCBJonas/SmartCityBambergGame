<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart City Bamberg Runner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #E31E24 0%, #9B4F96 50%, #0066B3 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        #gameContainer {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            position: relative;
            width: 95vw;
            max-width: 800px;
            height: 90vh;
            max-height: 600px;
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #E31E24 0%, #9B4F96 50%, #0066B3 100%);
            color: white;
            padding: 30px 40px 60px 40px;
            text-align: center;
            overflow-y: auto;
        }

        .hidden {
            display: none;
        }

        h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2em;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .unesco-badge {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 25px;
            display: inline-block;
        }

        button {
            background: white;
            color: #E31E24;
            border: none;
            padding: 18px 45px;
            font-size: 1.4em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            margin: 10px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            background: #f8f8f8;
        }

        button:active {
            transform: translateY(-1px);
        }

        .instructions {
            font-size: 1.1em;
            margin: 20px 0;
            line-height: 1.5;
            max-width: 600px;
        }

        .icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        #score {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 2em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 10;
        }

        #finalScore {
            font-size: 2.2em;
            margin: 20px 0;
            color: #FFD700;
        }

        .controls {
            position: absolute;
            bottom: 10px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 20;
            pointer-events: none;
        }

        .control-btn {
            width: 90px;
            height: 90px;
            font-size: 2em;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: all;
            flex-direction: column;
            gap: 5px;
            opacity: 0.85;
        }

        .control-label {
            font-size: 0.4em;
            font-weight: bold;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 2em;
            }
            .subtitle {
                font-size: 1em;
            }
            button {
                padding: 15px 35px;
                font-size: 1.2em;
            }
            .control-btn {
                width: 80px;
                height: 80px;
                font-size: 1.6em;
            }
            .control-label {
                font-size: 0.35em;
            }
            .controls {
                bottom: 8px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="score" class="hidden">Punkte: 0</div>
        
        <!-- Start Screen -->
        <div id="startScreen" class="screen">
            <div class="icon">üè∞</div>
            <h1>Smart City Bamberg</h1>
            <div class="unesco-badge">üåç UNESCO Welterbe</div>
            <p class="subtitle">Lauf durch die historische Altstadt!</p>
            <div class="instructions">
                <p><strong>üéÆ Steuerung:</strong> Nutze die Buttons unten</p>
                <p><strong>ü•ê Links:</strong> Bamberger H√∂rnchen werfen</p>
                <p><strong>‚¨ÜÔ∏è Rechts:</strong> √úber Hindernisse springen</p>
                <p><strong>üç∫ Sammle:</strong> Rauchbier-Kr√ºge f√ºr Extrapunkte</p>
                <p style="font-size: 0.95em; margin-top: 15px;">Erlebe die Bamberger Wahrzeichen:<br>Dom ¬∑ Altes Rathaus ¬∑ Altenburg ¬∑ Klein-Venedig</p>
            </div>
            <button id="startBtn" onclick="startGame()">Los geht's!</button>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="screen hidden">
            <div class="icon">üèÜ</div>
            <h1 style="margin-bottom: 10px;">Gut gelaufen!</h1>
            <div id="finalScore" style="margin-bottom: 15px;">Punkte: 0</div>
            <div id="highscoresDisplay" style="margin: 10px 0 15px 0; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 15px; min-width: 300px; max-width: 400px;">
                <h3 style="margin-bottom: 10px; font-size: 1.2em;">üèÖ Top 3 Highscores</h3>
                <div id="highscoresList" style="font-size: 1em; line-height: 1.8;">
                    <!-- Wird dynamisch bef√ºllt -->
                </div>
            </div>
            <p class="subtitle" style="margin-bottom: 15px;">Du hast Bamberg erkundet!</p>
            <button onclick="restartGame()">Nochmal spielen</button>
        </div>

        <!-- Game Canvas -->
        <canvas id="gameCanvas"></canvas>

        <!-- Touch Controls -->
        <div id="controls" class="controls hidden">
            <button class="control-btn" ontouchstart="handleShoot(event)" onclick="handleShoot(event)" style="background: #FFD700; color: #E31E24;">
                <span>ü•ê</span>
                <span class="control-label">SCHIE&szlig;EN</span>
            </button>
            <button class="control-btn" ontouchstart="handleJump(event)" onclick="handleJump(event)" style="background: white; color: #0066B3;">
                <span>‚¨ÜÔ∏è</span>
                <span class="control-label">SPRINGEN</span>
            </button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const scoreDisplay = document.getElementById('score');
        const finalScoreDisplay = document.getElementById('finalScore');
        const controls = document.getElementById('controls');

        let gameRunning = false;
        let score = 0;
        let highscores = [];
        let gameSpeed = 3;
        let gravity = 0.55;
        let jumpStrength = -11.5;

        // Highscore Management
        function loadHighscores() {
            const saved = localStorage.getItem('bambergGameHighscores');
            if (saved) {
                try {
                    highscores = JSON.parse(saved);
                } catch (e) {
                    highscores = [];
                }
            } else {
                highscores = [];
            }
        }

        function saveHighscores() {
            localStorage.setItem('bambergGameHighscores', JSON.stringify(highscores));
        }

        function addHighscore(newScore) {
            highscores.push(newScore);
            highscores.sort((a, b) => b - a); // Sortiere absteigend
            highscores = highscores.slice(0, 3); // Behalte nur Top 3
            saveHighscores();
        }

        function displayHighscores() {
            const highscoresList = document.getElementById('highscoresList');
            if (highscores.length === 0) {
                highscoresList.innerHTML = '<div style="opacity: 0.7;">Noch keine Highscores</div>';
                return;
            }

            const medals = ['ü•á', 'ü•à', 'ü•â'];
            let html = '';
            highscores.forEach((score, index) => {
                html += `<div style="display: flex; justify-content: space-between; align-items: center; padding: 5px 0;">
                    <span>${medals[index]} Platz ${index + 1}</span>
                    <span style="font-weight: bold; font-size: 1.2em;">${score} Punkte</span>
                </div>`;
            });
            highscoresList.innerHTML = html;
        }

        // Lade Highscores beim Start
        loadHighscores();

        // Player (Bamberger Reiter)
        const player = {
            x: 0, // Will be centered dynamically
            y: 0,
            width: 40,
            height: 50,
            velocityY: 0,
            jumping: false,
            color: '#8B4513'
        };

        // Resize canvas
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            // Center player
            player.x = canvas.width / 2 - player.width / 2;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Ground (Regnitz-Ufer)
        const ground = {
            height: 80,
            color: '#4682B4' // Blau f√ºr Regnitz
        };

        // Obstacles (Bamberg-typische Hindernisse)
        let obstacles = [];
        let obstacleTimer = 0;
        let obstacleInterval = 140;

        // Rauchbier collectibles
        let rauchbiers = [];
        let rauchbierTimer = 0;

        // Enemies (B√∂sewichte)
        let enemies = [];
        let enemyTimer = 0;

        // H√∂rnchen projectiles
        let hoernchen = [];
        let canShoot = true;
        let shootCooldown = 0;

        // Bamberg landmarks (background)
        let landmarks = [];
        let landmarkTypes = [
            { name: 'Fachwerk1', emoji: 'üèòÔ∏è', width: 70, height: 110, color: '#D2691E', roofColor: '#8B4513' },
            { name: 'Fachwerk2', emoji: 'üèòÔ∏è', width: 65, height: 100, color: '#CD853F', roofColor: '#654321' },
            { name: 'Fachwerk3', emoji: 'üèòÔ∏è', width: 75, height: 120, color: '#DEB887', roofColor: '#8B4513' },
            { name: 'Fachwerk4', emoji: 'üèòÔ∏è', width: 68, height: 105, color: '#F4A460', roofColor: '#A0522D' }
        ];

        // Clouds
        let clouds = [];

        // Regnitz waves
        let waveOffset = 0;

        // Initialize landmarks
        function createLandmarks() {
            landmarks = [];
            for (let i = 0; i < 6; i++) {
                const type = landmarkTypes[Math.floor(Math.random() * landmarkTypes.length)];
                landmarks.push({
                    x: i * 200,
                    type: type,
                    width: type.width,
                    height: type.height,
                    color: type.color,
                    roofColor: type.roofColor
                });
            }
        }

        // Initialize clouds
        function createClouds() {
            clouds = [];
            for (let i = 0; i < 4; i++) {
                clouds.push({
                    x: Math.random() * canvas.width,
                    y: 30 + Math.random() * 80,
                    width: 60 + Math.random() * 30,
                    speed: 0.3 + Math.random() * 0.4
                });
            }
        }

        function startGame() {
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            scoreDisplay.classList.remove('hidden');
            controls.classList.remove('hidden');
            gameRunning = true;
            score = 0;
            gameSpeed = 3;
            obstacles = [];
            rauchbiers = [];
            enemies = [];
            hoernchen = [];
            obstacleTimer = 0;
            rauchbierTimer = 0;
            enemyTimer = 0;
            shootCooldown = 0;
            canShoot = true;
            waveOffset = 0;
            player.x = canvas.width / 2 - player.width / 2;
            player.y = canvas.height - ground.height - player.height;
            player.velocityY = 0;
            player.jumping = false;
            createLandmarks();
            createClouds();
            gameLoop();
        }

        function restartGame() {
            startGame();
        }

        function handleJump(event) {
            event.preventDefault();
            jump();
        }

        function jump() {
            if (!gameRunning) return;
            if (!player.jumping) {
                player.velocityY = jumpStrength;
                player.jumping = true;
            }
        }

        function handleShoot(event) {
            event.preventDefault();
            shoot();
        }

        function shoot() {
            if (!gameRunning || !canShoot) return;
            
            hoernchen.push({
                x: player.x + player.width,
                y: player.y + player.height / 2 - 8,
                width: 16,
                height: 16,
                speed: 8
            });
            
            canShoot = false;
            shootCooldown = 30; // Cooldown frames
        }

        // Keyboard controls only - touch is handled by buttons
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'ArrowUp') {
                e.preventDefault();
                jump();
            }
            if (e.code === 'KeyS' || e.code === 'ArrowDown') {
                e.preventDefault();
                shoot();
            }
        });

        function updatePlayer() {
            player.velocityY += gravity;
            player.y += player.velocityY;

            const groundY = canvas.height - ground.height - player.height;
            if (player.y >= groundY) {
                player.y = groundY;
                player.velocityY = 0;
                player.jumping = false;
            }

            if (player.y < 0) {
                player.y = 0;
                player.velocityY = 0;
            }
        }

        function updateObstacles() {
            obstacleTimer++;
            if (obstacleTimer > obstacleInterval) {
                // Verschiedene Bamberg-Hindernisse
                const obstacleTypes = [
                    { width: 35, height: 45, color: '#8B4513', type: 'barrel' }, // Bierfass
                    { width: 30, height: 50, color: '#696969', type: 'stone' }, // Sandstein
                    { width: 40, height: 40, type: 'bench' } // Bank
                ];
                const type = obstacleTypes[Math.floor(Math.random() * obstacleTypes.length)];
                
                obstacles.push({
                    x: canvas.width,
                    y: canvas.height - ground.height - type.height,
                    width: type.width,
                    height: type.height,
                    color: type.color,
                    type: type.type
                });
                obstacleTimer = 0;
                obstacleInterval = 100 + Math.random() * 80;
            }

            obstacles.forEach((obstacle, index) => {
                obstacle.x -= gameSpeed;
                if (obstacle.x + obstacle.width < 0) {
                    obstacles.splice(index, 1);
                    score += 10;
                    scoreDisplay.textContent = `Punkte: ${score}`;
                }
            });
        }

        function updateRauchbiers() {
            rauchbierTimer++;
            if (rauchbierTimer > 85) {
                rauchbiers.push({
                    x: canvas.width,
                    y: canvas.height - ground.height - 80 - Math.random() * 120,
                    size: 25,
                    collected: false
                });
                rauchbierTimer = 0;
            }

            rauchbiers.forEach((beer, index) => {
                beer.x -= gameSpeed;
                if (beer.x + beer.size < 0) {
                    rauchbiers.splice(index, 1);
                }
            });
        }

        function updateEnemies() {
            enemyTimer++;
            if (enemyTimer > 160) {
                // Verschiedene B√∂sewichte
                const enemyTypes = ['tourist', 'grump', 'knight'];
                const type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
                
                enemies.push({
                    x: canvas.width,
                    y: canvas.height - ground.height - 45,
                    width: 35,
                    height: 45,
                    type: type,
                    hit: false
                });
                enemyTimer = 0;
            }

            enemies.forEach((enemy, index) => {
                enemy.x -= gameSpeed * 0.8;
                if (enemy.x + enemy.width < 0) {
                    enemies.splice(index, 1);
                }
            });
        }

        function updateHoernchen() {
            // Update shoot cooldown
            if (!canShoot) {
                shootCooldown--;
                if (shootCooldown <= 0) {
                    canShoot = true;
                }
            }

            hoernchen.forEach((horn, hornIndex) => {
                horn.x += horn.speed;
                
                // Remove if off screen
                if (horn.x > canvas.width) {
                    hoernchen.splice(hornIndex, 1);
                    return;
                }

                // Check collision with enemies
                enemies.forEach((enemy, enemyIndex) => {
                    if (!enemy.hit &&
                        horn.x < enemy.x + enemy.width &&
                        horn.x + horn.width > enemy.x &&
                        horn.y < enemy.y + enemy.height &&
                        horn.y + horn.height > enemy.y) {
                        
                        enemy.hit = true;
                        hoernchen.splice(hornIndex, 1);
                        enemies.splice(enemyIndex, 1);
                        score += 20; // Bonus f√ºr B√∂sewicht besiegen
                        scoreDisplay.textContent = `Punkte: ${score}`;
                    }
                });
            });
        }

        function updateLandmarks() {
            landmarks.forEach(landmark => {
                landmark.x -= gameSpeed * 0.25;
                if (landmark.x + landmark.width < 0) {
                    landmark.x = canvas.width;
                    const type = landmarkTypes[Math.floor(Math.random() * landmarkTypes.length)];
                    landmark.type = type;
                    landmark.width = type.width;
                    landmark.height = type.height;
                    landmark.color = type.color;
                    landmark.roofColor = type.roofColor;
                }
            });
        }

        function updateClouds() {
            clouds.forEach(cloud => {
                cloud.x -= cloud.speed;
                if (cloud.x + cloud.width < 0) {
                    cloud.x = canvas.width;
                    cloud.y = 30 + Math.random() * 80;
                }
            });
        }

        function checkCollisions() {
            // Check obstacle collision - only from sides, not from above
            for (let obstacle of obstacles) {
                // Check if player is above the obstacle
                const isAbove = player.y + player.height - 10 < obstacle.y;
                
                // Only collide if coming from the side (not from above)
                if (!isAbove &&
                    player.x < obstacle.x + obstacle.width - 10 &&
                    player.x + player.width - 10 > obstacle.x &&
                    player.y < obstacle.y + obstacle.height - 10 &&
                    player.y + player.height - 5 > obstacle.y) {
                    gameOver();
                    return;
                }
                
                // If jumping on top of obstacle, bounce up slightly
                if (isAbove && 
                    player.velocityY > 0 &&
                    player.x < obstacle.x + obstacle.width - 5 &&
                    player.x + player.width - 5 > obstacle.x &&
                    player.y + player.height >= obstacle.y &&
                    player.y + player.height <= obstacle.y + 15) {
                    player.velocityY = -8; // Small bounce
                    score += 5; // Bonus for jumping on obstacle
                    scoreDisplay.textContent = `Punkte: ${score}`;
                }
            }

            // Check enemy collision - only from sides, not from above
            for (let enemy of enemies) {
                if (enemy.hit) continue;
                
                // Check if player is above the enemy
                const isAbove = player.y + player.height - 10 < enemy.y;
                
                // Only collide if coming from the side (not from above)
                if (!isAbove &&
                    player.x < enemy.x + enemy.width - 8 &&
                    player.x + player.width - 8 > enemy.x &&
                    player.y < enemy.y + enemy.height - 8 &&
                    player.y + player.height - 5 > enemy.y) {
                    gameOver();
                    return;
                }
                
                // If jumping on enemy from above, defeat them
                if (isAbove && 
                    player.velocityY > 0 &&
                    player.x < enemy.x + enemy.width - 5 &&
                    player.x + player.width - 5 > enemy.x &&
                    player.y + player.height >= enemy.y &&
                    player.y + player.height <= enemy.y + 15) {
                    enemy.hit = true;
                    enemies.splice(enemies.indexOf(enemy), 1);
                    player.velocityY = -9; // Bounce up
                    score += 25; // Bonus for jumping on enemy
                    scoreDisplay.textContent = `Punkte: ${score}`;
                }
            }

            // Check Rauchbier collection
            rauchbiers.forEach((beer, index) => {
                if (!beer.collected &&
                    player.x < beer.x + beer.size &&
                    player.x + player.width > beer.x &&
                    player.y < beer.y + beer.size &&
                    player.y + player.height > beer.y) {
                    beer.collected = true;
                    rauchbiers.splice(index, 1);
                    score += 15; // Mehr Punkte f√ºr Rauchbier!
                    scoreDisplay.textContent = `Punkte: ${score}`;
                }
            });
        }

        function gameOver() {
            gameRunning = false;
            scoreDisplay.classList.add('hidden');
            controls.classList.add('hidden');
            
            // Pr√ºfe ob es ein neuer Highscore ist
            let isNewHighscore = false;
            if (score > 0) {
                if (highscores.length < 3 || score > highscores[highscores.length - 1]) {
                    isNewHighscore = true;
                }
                addHighscore(score);
            }
            
            finalScoreDisplay.textContent = `Punkte: ${score}`;
            
            // Zeige "Neuer Highscore!" wenn zutreffend
            if (isNewHighscore && score > 0) {
                finalScoreDisplay.innerHTML = `Punkte: ${score}<br><span style="font-size: 0.6em; color: #FFD700;">‚≠ê Neuer Highscore! ‚≠ê</span>`;
            }
            
            displayHighscores();
            gameOverScreen.classList.remove('hidden');
        }

        function drawBackground() {
            // Sky gradient (Smart City Bamberg Design: Rot zu Blau)
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height - ground.height);
            gradient.addColorStop(0, '#E31E24'); // Smart City Rot
            gradient.addColorStop(0.5, '#9B4F96'); // √úbergang Lila
            gradient.addColorStop(1, '#0066B3'); // Smart City Blau
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height - ground.height);
        }

        function drawClouds() {
            clouds.forEach(cloud => {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.beginPath();
                ctx.arc(cloud.x, cloud.y, cloud.width / 3, 0, Math.PI * 2);
                ctx.arc(cloud.x + cloud.width / 3, cloud.y - 8, cloud.width / 2.5, 0, Math.PI * 2);
                ctx.arc(cloud.x + cloud.width / 1.5, cloud.y, cloud.width / 3, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawLandmarks() {
            landmarks.forEach(landmark => {
                const baseY = canvas.height - ground.height - landmark.height;
                
                // Fachwerkhaus - Hauptgeb√§ude
                ctx.fillStyle = landmark.color;
                ctx.fillRect(
                    landmark.x,
                    baseY,
                    landmark.width,
                    landmark.height
                );

                // Dach (Satteldach - typisch fr√§nkisch)
                ctx.fillStyle = landmark.roofColor;
                ctx.beginPath();
                ctx.moveTo(landmark.x - 5, baseY);
                ctx.lineTo(landmark.x + landmark.width / 2, baseY - 25);
                ctx.lineTo(landmark.x + landmark.width + 5, baseY);
                ctx.closePath();
                ctx.fill();

                // Fachwerk-Balken (horizontale Balken)
                ctx.strokeStyle = '#4A2511';
                ctx.lineWidth = 3;
                
                // Horizontale Balken
                for (let i = 1; i < 4; i++) {
                    const y = baseY + (landmark.height / 4) * i;
                    ctx.beginPath();
                    ctx.moveTo(landmark.x, y);
                    ctx.lineTo(landmark.x + landmark.width, y);
                    ctx.stroke();
                }

                // Vertikale Balken
                ctx.lineWidth = 2.5;
                const numVertical = 3;
                for (let i = 1; i <= numVertical; i++) {
                    const x = landmark.x + (landmark.width / (numVertical + 1)) * i;
                    ctx.beginPath();
                    ctx.moveTo(x, baseY);
                    ctx.lineTo(x, baseY + landmark.height);
                    ctx.stroke();
                }

                // Diagonale Streben (typisch f√ºr Fachwerk)
                ctx.lineWidth = 2;
                for (let i = 0; i < 2; i++) {
                    const startX = landmark.x + (landmark.width / 3) * i + 10;
                    const startY = baseY + landmark.height / 3;
                    const endX = startX + 15;
                    const endY = startY + landmark.height / 3;
                    
                    ctx.beginPath();
                    ctx.moveTo(startX, startY);
                    ctx.lineTo(endX, endY);
                    ctx.stroke();
                    
                    // Gegenrichtung
                    ctx.beginPath();
                    ctx.moveTo(endX, startY);
                    ctx.lineTo(startX, endY);
                    ctx.stroke();
                }

                // Fenster (kleine Sprossenfenster)
                ctx.fillStyle = 'rgba(255, 255, 220, 0.7)';
                const windowWidth = 12;
                const windowHeight = 15;
                const windowsPerRow = 2;
                const windowRows = 2;
                
                for (let row = 0; row < windowRows; row++) {
                    for (let col = 0; col < windowsPerRow; col++) {
                        const windowX = landmark.x + 15 + col * 25;
                        const windowY = baseY + 20 + row * 35;
                        
                        // Fenster
                        ctx.fillRect(windowX, windowY, windowWidth, windowHeight);
                        
                        // Fensterkreuz (Sprosse)
                        ctx.strokeStyle = '#4A2511';
                        ctx.lineWidth = 1.5;
                        ctx.beginPath();
                        ctx.moveTo(windowX + windowWidth / 2, windowY);
                        ctx.lineTo(windowX + windowWidth / 2, windowY + windowHeight);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(windowX, windowY + windowHeight / 2);
                        ctx.lineTo(windowX + windowWidth, windowY + windowHeight / 2);
                        ctx.stroke();
                    }
                }

                // T√ºr (Holzt√ºr)
                const doorWidth = 18;
                const doorHeight = 30;
                const doorX = landmark.x + landmark.width / 2 - doorWidth / 2;
                const doorY = baseY + landmark.height - doorHeight;
                
                ctx.fillStyle = '#654321';
                ctx.fillRect(doorX, doorY, doorWidth, doorHeight);
                
                // T√ºrgriff
                ctx.fillStyle = '#FFD700';
                ctx.beginPath();
                ctx.arc(doorX + doorWidth - 4, doorY + doorHeight / 2, 2, 0, Math.PI * 2);
                ctx.fill();

                // Dachziegel-Textur
                ctx.strokeStyle = landmark.roofColor;
                ctx.lineWidth = 1;
                for (let i = 0; i < 8; i++) {
                    ctx.beginPath();
                    ctx.moveTo(landmark.x, baseY - 5 - i * 3);
                    ctx.lineTo(landmark.x + landmark.width, baseY - 5 - i * 3);
                    ctx.stroke();
                }
            });
        }

        function drawGround() {
            // Regnitz (Wasser)
            ctx.fillStyle = '#4682B4';
            ctx.fillRect(0, canvas.height - ground.height, canvas.width, ground.height);

            // Wellen-Effekt
            waveOffset += 0.05;
            ctx.strokeStyle = '#5F9ED1';
            ctx.lineWidth = 2;
            for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                for (let x = 0; x < canvas.width; x += 10) {
                    const y = canvas.height - ground.height + 20 + i * 15 + Math.sin((x + waveOffset * 50) / 30) * 3;
                    if (x === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }

            // Ufer-Linie
            ctx.fillStyle = '#8B7355';
            ctx.fillRect(0, canvas.height - ground.height - 3, canvas.width, 3);
        }

        function drawPlayer() {
            // Shadow
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.ellipse(
                player.x + player.width / 2,
                canvas.height - ground.height - 5,
                player.width / 2 + 5,
                5,
                0,
                0,
                Math.PI * 2
            );
            ctx.fill();

            // Bamberger Reiter - nach rechts schauend
            const horseY = player.y + 25;
            const horseHeight = 25;
            
            // Pferdek√∂rper (braun)
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.ellipse(player.x + 20, horseY, 18, 12, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Pferdehals (rechts)
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.ellipse(player.x + 32, horseY - 5, 8, 10, 0.3, 0, Math.PI * 2);
            ctx.fill();
            
            // Pferdekopf (rechts)
            ctx.fillStyle = '#A0522D';
            ctx.beginPath();
            ctx.ellipse(player.x + 35, horseY - 12, 6, 7, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Pferdem√§hne (schwarz)
            ctx.fillStyle = '#2F1F1F';
            ctx.beginPath();
            ctx.moveTo(player.x + 32, horseY - 12);
            ctx.lineTo(player.x + 30, horseY - 8);
            ctx.lineTo(player.x + 34, horseY - 8);
            ctx.fill();
            
            // Pferdebeine
            ctx.strokeStyle = '#654321';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(player.x + 12, horseY + 10);
            ctx.lineTo(player.x + 12, horseY + 22);
            ctx.moveTo(player.x + 18, horseY + 10);
            ctx.lineTo(player.x + 18, horseY + 22);
            ctx.moveTo(player.x + 24, horseY + 10);
            ctx.lineTo(player.x + 24, horseY + 22);
            ctx.moveTo(player.x + 30, horseY + 10);
            ctx.lineTo(player.x + 30, horseY + 22);
            ctx.stroke();
            
            // Pferdeschwanz (links)
            ctx.strokeStyle = '#2F1F1F';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(player.x + 5, horseY);
            ctx.quadraticCurveTo(player.x, horseY + 5, player.x + 2, horseY + 12);
            ctx.stroke();
            
            // Reiter (Bamberger Reiter) - K√∂rper
            ctx.fillStyle = '#4169E1'; // K√∂nigsblau f√ºr den Mantel
            ctx.beginPath();
            ctx.ellipse(player.x + 20, player.y + 15, 10, 13, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Kopf des Reiters
            ctx.fillStyle = '#FFE4C4';
            ctx.beginPath();
            ctx.arc(player.x + 20, player.y + 5, 7, 0, Math.PI * 2);
            ctx.fill();
            
            // Krone (K√∂nig)
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.moveTo(player.x + 13, player.y - 1);
            ctx.lineTo(player.x + 15, player.y - 5);
            ctx.lineTo(player.x + 17, player.y - 2);
            ctx.lineTo(player.x + 20, player.y - 6);
            ctx.lineTo(player.x + 23, player.y - 2);
            ctx.lineTo(player.x + 25, player.y - 5);
            ctx.lineTo(player.x + 27, player.y - 1);
            ctx.lineTo(player.x + 27, player.y + 1);
            ctx.lineTo(player.x + 13, player.y + 1);
            ctx.fill();
            
            // Krone Juwel (rot)
            ctx.fillStyle = '#DC143C';
            ctx.beginPath();
            ctx.arc(player.x + 20, player.y - 3, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // Gesicht Details (nach rechts)
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(player.x + 22, player.y + 4, 1, 2); // Auge rechts sichtbar
            
            // Bart
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.arc(player.x + 20, player.y + 9, 4, 0, Math.PI);
            ctx.fill();
            
            // Umhang/Mantel
            ctx.fillStyle = '#4169E1';
            ctx.beginPath();
            ctx.moveTo(player.x + 15, player.y + 12);
            ctx.quadraticCurveTo(player.x + 10, player.y + 20, player.x + 12, player.y + 28);
            ctx.lineTo(player.x + 18, player.y + 28);
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(player.x + 25, player.y + 12);
            ctx.quadraticCurveTo(player.x + 30, player.y + 20, player.x + 28, player.y + 28);
            ctx.lineTo(player.x + 22, player.y + 28);
            ctx.fill();
            
            // Schwert (nach rechts zeigend)
            ctx.strokeStyle = '#C0C0C0';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(player.x + 28, player.y + 18);
            ctx.lineTo(player.x + 35, player.y + 22);
            ctx.stroke();
            
            // Schwertgriff
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(player.x + 27, player.y + 16, 3, 4);
            
            // Schwertspitze
            ctx.fillStyle = '#C0C0C0';
            ctx.beginPath();
            ctx.moveTo(player.x + 35, player.y + 22);
            ctx.lineTo(player.x + 38, player.y + 21);
            ctx.lineTo(player.x + 36, player.y + 23);
            ctx.fill();
        }

        function drawObstacles() {
            obstacles.forEach(obstacle => {
                if (obstacle.type === 'barrel') {
                    // Bierfass
                    ctx.fillStyle = '#8B4513';
                    ctx.beginPath();
                    ctx.ellipse(obstacle.x + obstacle.width / 2, obstacle.y + 5, obstacle.width / 2, 8, 0, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillRect(obstacle.x, obstacle.y + 5, obstacle.width, obstacle.height - 10);
                    ctx.beginPath();
                    ctx.ellipse(obstacle.x + obstacle.width / 2, obstacle.y + obstacle.height - 5, obstacle.width / 2, 8, 0, 0, Math.PI * 2);
                    ctx.fill();

                    // Fass-Ringe
                    ctx.strokeStyle = '#654321';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.ellipse(obstacle.x + obstacle.width / 2, obstacle.y + 15, obstacle.width / 2, 6, 0, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.ellipse(obstacle.x + obstacle.width / 2, obstacle.y + obstacle.height - 15, obstacle.width / 2, 6, 0, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (obstacle.type === 'stone') {
                    // Sandstein-Block (typisch Bamberg)
                    ctx.fillStyle = '#D2B48C';
                    ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                    ctx.strokeStyle = '#C0A888';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                    
                    // Sandstein-Struktur
                    for (let i = 0; i < 3; i++) {
                        ctx.strokeStyle = 'rgba(160, 130, 100, 0.3)';
                        ctx.beginPath();
                        ctx.moveTo(obstacle.x, obstacle.y + 15 * i);
                        ctx.lineTo(obstacle.x + obstacle.width, obstacle.y + 15 * i);
                        ctx.stroke();
                    }
                } else {
                    // Bank
                    ctx.fillStyle = '#654321';
                    ctx.fillRect(obstacle.x, obstacle.y + 25, obstacle.width, 5);
                    ctx.fillRect(obstacle.x, obstacle.y + 10, 5, 30);
                    ctx.fillRect(obstacle.x + obstacle.width - 5, obstacle.y + 10, 5, 30);
                    ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, 12);
                }
            });
        }

        function drawRauchbiers() {
            rauchbiers.forEach(beer => {
                // Bierkrug mit Rauchbier
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(beer.x + 3, beer.y + 8, beer.size - 6, beer.size - 8);
                
                // Henkel
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(beer.x + beer.size - 2, beer.y + 15, 6, -Math.PI / 2, Math.PI / 2);
                ctx.stroke();

                // Rauchbier (dunkel)
                ctx.fillStyle = '#4A2511';
                ctx.fillRect(beer.x + 4, beer.y + 9, beer.size - 8, beer.size - 13);

                // Schaum
                ctx.fillStyle = '#FFF8DC';
                ctx.beginPath();
                ctx.arc(beer.x + 8, beer.y + 8, 4, 0, Math.PI * 2);
                ctx.arc(beer.x + 14, beer.y + 7, 4, 0, Math.PI * 2);
                ctx.arc(beer.x + 20, beer.y + 8, 4, 0, Math.PI * 2);
                ctx.fill();

                // Rauch-Effekt
                ctx.fillStyle = 'rgba(128, 128, 128, 0.3)';
                ctx.beginPath();
                ctx.arc(beer.x + beer.size / 2, beer.y - 3, 3, 0, Math.PI * 2);
                ctx.arc(beer.x + beer.size / 2 + 3, beer.y - 7, 2, 0, Math.PI * 2);
                ctx.fill();

                // Sparkle
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(beer.x - 2, beer.y - 8, 2, 5);
                ctx.fillRect(beer.x - 5, beer.y - 2, 5, 2);
            });
        }

        function drawEnemies() {
            enemies.forEach(enemy => {
                if (enemy.type === 'tourist') {
                    // Tourist mit Kamera
                    ctx.fillStyle = '#FF6B6B';
                    ctx.fillRect(enemy.x, enemy.y + 15, enemy.width, enemy.height - 15);
                    
                    // Kopf
                    ctx.fillStyle = '#FFE4C4';
                    ctx.beginPath();
                    ctx.arc(enemy.x + enemy.width / 2, enemy.y + 10, 10, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Hut
                    ctx.fillStyle = '#F4E04D';
                    ctx.beginPath();
                    ctx.ellipse(enemy.x + enemy.width / 2, enemy.y + 3, 12, 5, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Kamera
                    ctx.fillStyle = '#333';
                    ctx.fillRect(enemy.x + enemy.width / 2 - 5, enemy.y + 22, 10, 8);
                    ctx.fillStyle = '#666';
                    ctx.beginPath();
                    ctx.arc(enemy.x + enemy.width / 2, enemy.y + 26, 4, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Augen (verwirrt)
                    ctx.fillStyle = '#000';
                    ctx.fillRect(enemy.x + 13, enemy.y + 8, 2, 2);
                    ctx.fillRect(enemy.x + 20, enemy.y + 8, 2, 2);
                } else if (enemy.type === 'grump') {
                    // M√ºrrischer Bamberger
                    ctx.fillStyle = '#4A4A4A';
                    ctx.fillRect(enemy.x, enemy.y + 15, enemy.width, enemy.height - 15);
                    
                    // Kopf
                    ctx.fillStyle = '#FFE4C4';
                    ctx.beginPath();
                    ctx.arc(enemy.x + enemy.width / 2, enemy.y + 10, 10, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Augen (grimmig)
                    ctx.fillStyle = '#000';
                    ctx.fillRect(enemy.x + 12, enemy.y + 8, 3, 2);
                    ctx.fillRect(enemy.x + 20, enemy.y + 8, 3, 2);
                    
                    // Frown
                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 1.5;
                    ctx.beginPath();
                    ctx.arc(enemy.x + enemy.width / 2, enemy.y + 16, 4, 0.8, Math.PI - 0.8, true);
                    ctx.stroke();
                } else if (enemy.type === 'knight') {
                    // Feindlicher Ritter
                    ctx.fillStyle = '#2F2F2F';
                    ctx.fillRect(enemy.x, enemy.y + 15, enemy.width, enemy.height - 15);
                    
                    // Kopf
                    ctx.fillStyle = '#696969';
                    ctx.beginPath();
                    ctx.arc(enemy.x + enemy.width / 2, enemy.y + 10, 10, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Helm (mit Visier)
                    ctx.fillStyle = '#4A4A4A';
                    ctx.beginPath();
                    ctx.arc(enemy.x + enemy.width / 2, enemy.y + 8, 11, Math.PI, 0, true);
                    ctx.fill();
                    
                    // Visier-Schlitz
                    ctx.fillStyle = '#1A1A1A';
                    ctx.fillRect(enemy.x + 12, enemy.y + 8, 11, 3);
                    
                    // Helm-Spitze
                    ctx.fillStyle = '#696969';
                    ctx.beginPath();
                    ctx.moveTo(enemy.x + enemy.width / 2, enemy.y - 2);
                    ctx.lineTo(enemy.x + enemy.width / 2 - 4, enemy.y + 4);
                    ctx.lineTo(enemy.x + enemy.width / 2 + 4, enemy.y + 4);
                    ctx.fill();
                    
                    // R√ºstung (Plattenpanzer)
                    ctx.fillStyle = '#808080';
                    ctx.fillRect(enemy.x + 8, enemy.y + 18, enemy.width - 16, 15);
                    
                    // G√ºrtel
                    ctx.fillStyle = '#654321';
                    ctx.fillRect(enemy.x + 5, enemy.y + 32, enemy.width - 10, 3);
                    
                    // Beine (dunkle Hose)
                    ctx.fillStyle = '#3A3A3A';
                    ctx.fillRect(enemy.x + 10, enemy.y + 35, 6, 10);
                    ctx.fillRect(enemy.x + 19, enemy.y + 35, 6, 10);
                    
                    // Schild (links)
                    ctx.fillStyle = '#8B0000';
                    ctx.beginPath();
                    ctx.arc(enemy.x + 5, enemy.y + 25, 7, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Schild-Kreuz
                    ctx.strokeStyle = '#FFD700';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(enemy.x + 5, enemy.y + 20);
                    ctx.lineTo(enemy.x + 5, enemy.y + 30);
                    ctx.moveTo(enemy.x, enemy.y + 25);
                    ctx.lineTo(enemy.x + 10, enemy.y + 25);
                    ctx.stroke();
                    
                    // Schwert (rechts, nach oben)
                    ctx.strokeStyle = '#C0C0C0';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(enemy.x + 30, enemy.y + 30);
                    ctx.lineTo(enemy.x + 33, enemy.y + 18);
                    ctx.stroke();
                    
                    // Schwertgriff
                    ctx.fillStyle = '#654321';
                    ctx.fillRect(enemy.x + 29, enemy.y + 30, 5, 3);
                }
            });
        }

        function drawHoernchen() {
            hoernchen.forEach(horn => {
                // Bamberger H√∂rnchen (Croissant-√§hnlich)
                ctx.fillStyle = '#D2691E';
                
                // Hauptform des H√∂rnchens
                ctx.beginPath();
                ctx.arc(horn.x, horn.y + horn.height / 2, horn.height / 2, Math.PI / 2, -Math.PI / 2);
                ctx.arc(horn.x + horn.width, horn.y + horn.height / 2, horn.height / 2, -Math.PI / 2, Math.PI / 2);
                ctx.closePath();
                ctx.fill();
                
                // Gekr√ºmmte Enden (H√∂rnchenform)
                ctx.beginPath();
                ctx.arc(horn.x + 2, horn.y + 2, 4, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(horn.x + 2, horn.y + horn.height - 2, 4, 0, Math.PI * 2);
                ctx.fill();
                
                // Glanz
                ctx.fillStyle = '#F4A460';
                ctx.beginPath();
                ctx.ellipse(horn.x + horn.width / 2, horn.y + horn.height / 3, 4, 2, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Streifen (B√§ckerei-Detail)
                ctx.strokeStyle = '#B8860B';
                ctx.lineWidth = 1;
                for (let i = 0; i < 3; i++) {
                    ctx.beginPath();
                    ctx.moveTo(horn.x + 3 + i * 4, horn.y + 2);
                    ctx.lineTo(horn.x + 3 + i * 4, horn.y + horn.height - 2);
                    ctx.stroke();
                }
            });
        }

        function gameLoop() {
            if (!gameRunning) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawBackground();
            drawClouds();
            drawLandmarks();
            drawGround();
            drawRauchbiers();
            drawEnemies();
            drawHoernchen();
            drawObstacles();
            drawPlayer();

            updatePlayer();
            updateObstacles();
            updateRauchbiers();
            updateEnemies();
            updateHoernchen();
            updateLandmarks();
            updateClouds();
            checkCollisions();

            // Increase difficulty
            if (score % 100 === 0 && score > 0) {
                gameSpeed += 0.08;
            }

            requestAnimationFrame(gameLoop);
        }

        // Helper for rounded rectangles
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function(x, y, width, height, radius) {
                this.beginPath();
                this.moveTo(x + radius, y);
                this.lineTo(x + width - radius, y);
                this.quadraticCurveTo(x + width, y, x + width, y + radius);
                this.lineTo(x + width, y + height - radius);
                this.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                this.lineTo(x + radius, y + height);
                this.quadraticCurveTo(x, y + height, x, y + height - radius);
                this.lineTo(x, y + radius);
                this.quadraticCurveTo(x, y, x + radius, y);
                this.closePath();
            };
        }
    </script>
</body>
</html>